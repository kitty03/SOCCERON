<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>Ingresar</title>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/micss.css">
</head>
<body class="fondo animated fadeIn">
<div class="container">
    <div class="center-align col s12">
        <img src="img/logo_index.jpg" alt="logo" class="col s12 responsive-img"/>
    </div>
    <div class="row fondo2 center-align" style="padding-top: 10px;margin-left:0;margin-right:0;height:100%">
      <div class="center-align col s10 offset-s1" style="padding-top:12px">
          <a class="waves-effect waves-light btn blue darken-4" style="display: block; width: 100%;" href="http://socceron.16mb.com/facebook" target="_blank"><span class="fa fa-facebook-official"></span> continuar con facebook</a>
      </div>
      <div class="linea center-align col s12"><br></div>
      <br>
      <div id="login-form" >
        <div v-if="formulario==1">
          <form class="col s10 offset-s1"  v-on:submit.prevent="enviar">
              <p>{{mensaje}}</p>
              <div class="row">
                  <div class="input-field">
                      <i class="material-icons prefix">perm_identity</i>
                      <input  type="email" class="validate" v-model="usuario"/>
                      <label for="icon_prefix">Ingrese su email</label>
                  </div>
                  <div class="input-field">
                      <i class="material-icons prefix">lock</i>
                      <input type="password" class="validate" v-model="contrasena"/>
                      <label for="icon_prefix">Contrasena</label>
                  </div>
              </div>
              <div class="center-align col s10 offset-s1">
                  <button class="waves-effect waves-light btn grey" style="display: block; width: 100%;" type="submit">INICIAR SESION</button>
                  <p>Olvidaste tu contrasena?</p>
                  <p>No tienes una cuenta? <a href="#" v-on:click="registrar">Registrarte</a></p>
              </div>
          </form>
        </div>
        <div v-if="formulario==2">
          <p>Procesando</p>
          <div class="preloader-wrapper active">
          <div class="spinner-layer spinner-blue">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div><div class="gap-patch">
              <div class="circle"></div>
            </div><div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>

</div>
<script src="js/jquery.min.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/materialize.min.js"></script>
<script src="js/vue.js"></script>
<script>

const login = new Vue({
    el: '#login-form',
    data: {
        usuario: '',
        contrasena:'',
        formulario:0,
        mensaje:'Ingrese sus credenciales'
    },
    methods: {
        enviar: function(e){
              e.preventDefault();
              if(this.usuario!=='' && this.contrasena!==''){
                this.formulario=2;
                  axios({
                      method: 'POST',
                      url: 'http://socceron.16mb.com/api/ingresar',
                      data: {
                          correo: this.usuario,
                          contrasena: this.contrasena,
                      },
                  }).then((response) => {
                    this.formulario=1;
                    this.mensaje=response.data.mensaje;
                    if(response.data.estado){
                      console.log('Login correcto');
                      window.location.href='principal.html';
                    }else{
                      console.log('Login incorrecto');
                      this.usuario='';
                      this.contrasena='';
                    }
                  }).catch((error) => {
                      this.formulario=1;
                      this.usuario='';
                      this.contrasena='';
                      console.log(error);
                  });
              }else{
                  this.mensaje='Debe completar los campos';
              }
        },
        registrar:function(){
          window.location.href='registro.html';
        },
        comprobar:function(){
          axios({
              method: 'GET',
              url: 'http://socceron.16mb.com/api/comprobar',
          }).then((response) => {
            if(response.data.estado){
              console.log('Login correcto');
              window.location.href='principal.html';
            }else{
              console.log('Login incorrecto');
            }
          });
        }
    },
    created(){
      this.formulario=1;
      this.comprobar();
    }
});
</script>
</body>
</html>
