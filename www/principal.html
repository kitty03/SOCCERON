<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1,width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>SOCCERON</title>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/micss.css">
    <style>
       #map {
        height: 100%;
        width: 100%;
        position: absolute;
       }
    </style>

</head>
<body class="fondo animated fadeIn">
  <div id="principal">
    <nav class="nav-extended light-blue darken-4">
      <div class="nav-wrapper">
        <a href="principal.html" class="brand-logo" style="font-size: 1.2rem">SOCCERON</a>
        <a href="#" data-activates="menu" class="button-collapse"><i class="material-icons">menu</i></a>
        <ul class="side-nav" id="menu">
          <li>
            <div class="userView">
              <div class="background">
                  <img src="img/fondo.jpg">
              </div>
              <a href="#!user"><img class="circle" :src="foto" ></a>
              <a href="#!name"><span class="white-text name">{{nombre}} <br> {{correo}}</span></a>
              <br>
            </div>
          </li>
          <li><a href="#contactenos"><i class="material-icons">forum</i> Contactenos</a></li>
          <li><a href="#ayuda"><i class="material-icons">help</i> Ayuda</a></li>
          <li><a href="#config"><i class="material-icons">settings</i> Ajustes</a></li>
          <li><a href="#cerrar" v-on:click="cerrarSesion()"><i class="material-icons">info</i> Cerrar Sesion</a></li>
        </ul>
        <ul class="right">
          <li><a href="#notificaciones"><i class="material-icons">notifications</i></a></li>
        </ul>
      </div>
      <div class="nav-content">
        <ul class="tabs tabs-transparent">
          <li class="tab"><a class="active" href="#inicio">INICIO</a></li>
          <li class="tab"><a href="#partidas">PARTIDAS</a></li>
        </ul>
      </div>
    </nav>
    <div id="inicio" class="col s12">
      <div class="card">
        <div class="card-image">
          <img src="img/fondo.jpg" style="height:90px"/>
        </div>
        <div class="card-content">
          <div class="row">
            <div class="col s6 offset-s3 foto-perfil">
              <img class="circle responsive-img" :src="foto"  />
            </div>
          </div>
          <span class="card-title black-text center-align">{{nombre}}</span>
        </div>
      </div>
      <div>
        <ul class="collection with-header">
         <li class="collection-header"><h6>Mis Partidas</h6></li>
       </ul>
       <div class="collection" v-for="partida in partidas">
          <a href="#!" class="collection-item" v-on:click="recargar(partida.id_)">{{partida.descripcion_ca}}</a>
        </div>
      </div>
      <div>
        <ul class="collection with-header">
         <li class="collection-header"><h6>Partidas recomendadas</h6></li>
       </ul>
       <ul class="collection" v-for="sugerencia in sugerencias">
        <li class="collection-item avatar" v-on:click="recargar(sugerencia.id_)">
          <i class="material-icons circle red">play_arrow</i>
          <span class="title">{{sugerencia.descripcion_ca}}</span>
          <p>{{sugerencia.creador}}<br>
             <small class="right-align">{{sugerencia.empieza_pa}}</small>
          </p>
        </li>
      </ul>
      </div>
    </div>
    <div id="partidas" class="col s12">
      <div id="map"></div>
      <div class="fixed-action-btn horizontal">
        <a class="btn-floating btn-large blue waves-effect waves-light" title="Agregar Partida" href="crear_partido.html">
          <i class="material-icons"><i class="material-icons">add</i></i>
        </a>
      </div>
    </div>
  </div>
<script src="js/jquery.min.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/materialize.min.js"></script>
<script src="js/vue.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDv8Osn5X_k12-In9NLjyI3wZoCf8Ta0LE" ></script>
<script>
      const principal = new Vue({
          el: '#principal',
          data: {
              usuario: 0,
              nombre:'',
              correo:'',
              foto:'',
              sugerencias:[],
              partidas:[],
          },
          methods: {
            comprobarSesion:function(){
              axios({
                  method: 'GET',
                  url: 'http://socceron.16mb.com/api/comprobar',
              }).then((response) => {
                if(response.data.estado){
                  //mapa
                  $(".button-collapse").sideNav();

                  //informacion del usuaria
                  var jugador=response.data.info;
                  this.usuario=jugador.id_ju;
                  this.nombre=jugador.nombre_ju;
                  this.correo=jugador.correo_ju;
                  if(jugador.fb_ju!=='')
                    this.foto=jugador.fb_ju;
                  else
                    this.foto='img/defecto.png';
                    this.cargar();
                }else{
                  window.location.href='login.html';
                }
              }).catch((error) => {
                  console.log(error);
                  window.location.href='login.html';
              });

            },
            cargar:function(){
              //sugeridas
              axios({
                  method: 'GET',
                  url: 'http://socceron.16mb.com/api/jugador/partida',
              }).then((response) => {
                this.sugerencias=response.data;
              }).catch((error) => {
                  console.log(error);
              });
              console.log(this.sugeridas);

              //mis partidas
              axios({
                  method: 'GET',
                  url: 'http://socceron.16mb.com/api/jugador/partida/ver',
              }).then((response) => {
                this.partidas=response.data;
              }).catch((error) => {
                  console.log(error);
              });
            },
            cerrarSesion:function(){
              axios({
                  method: 'DELETE',
                  url: 'http://socceron.16mb.com/api/ingresar',
              }).then((response) => {
                 window.location.href='login.html';
              }).catch((error) => {
                  console.log(error);
              });
            },
            recargar:function(codigo){
              localStorage.setItem("partida",codigo);
              window.location.href='partida.html';
            },

          },
          created(){
            //this.dibujarMapa();
            this.comprobarSesion();
          },
          mounted(){
            var map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: -0.2103317149386794, lng: -78.49101722341766},
              scrollwheel: false,
              zoom: 8,
              disableDefaultUI: true,
              fullscreenControl: true,
              styles:[{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}]
            });
            var myLatLng = {lat: -0.2103317149386794, lng: -78.49101722341766};
            var marker = new google.maps.Marker({
              position: myLatLng,
              map: map,
              title: '1'
            });
          }
      });
</script>


</body>
</html>
